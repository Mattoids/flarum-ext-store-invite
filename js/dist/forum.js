(()=>{var t={n:i=>{var a=i&&i.__esModule?()=>i.default:()=>i;return t.d(a,{a}),a},d:(i,a)=>{for(var e in a)t.o(a,e)&&!t.o(i,e)&&Object.defineProperty(i,e,{enumerable:!0,get:a[e]})},o:(t,i)=>Object.prototype.hasOwnProperty.call(t,i),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},i={};(()=>{"use strict";t.r(i);const a=flarum.core.compat["common/app"];t.n(a)().initializers.add("mattoid/flarum-ext-store-invite",(function(){console.log("[mattoid/flarum-ext-store-invite] Hello, forum and admin!")}));const e=flarum.core.compat["forum/app"];var n=t.n(e);const s=flarum.core.compat["common/extend"];function o(t,i){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t},o(t,i)}function r(t,i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,o(t,i)}const l=flarum.core.compat["forum/components/IndexPage"];var u=t.n(l);const c=flarum.core.compat["common/helpers/listItems"];var d=t.n(c);const v=flarum.core.compat["common/utils/Stream"];var p=t.n(v);const h=flarum.core.compat["common/components/Select"];var f=t.n(h);const b=flarum.core.compat["common/Component"];var g=t.n(b);const y=flarum.core.compat["common/components/LinkButton"];var D=t.n(y);const k=flarum.core.compat["common/components/Button"];var x=t.n(k),I=function(t){function i(){for(var i,a=arguments.length,e=new Array(a),n=0;n<a;n++)e[n]=arguments[n];return(i=t.call.apply(t,[this].concat(e))||this).buttonName="expand",i.class="",i.params={},i.inviteData={},i}r(i,t);var a=i.prototype;return a.oninit=function(i){t.prototype.oninit.call(this,i),this.inviteData=this.attrs.item.attributes,this.params.id=this.inviteData.id},a.view=function(){var t=this,i=m("div",[m("div.spacing",[m("label",n().translator.trans("mattoid-store-invite.lib.item-confirm-user")+": "),m("span",D().component({href:"/u/"+this.inviteData.confirmUser},m("img",{className:"Invite-Icon",src:this.inviteData.confirmUserImg}))),m("span",D().component({href:"/u/"+this.inviteData.confirmUser},this.inviteData.confirmUser)),m("span.horizontal-spacing"," | "),m("label",n().translator.trans("mattoid-store-invite.lib.item-confirm-status")+": "),m("span",1==this.inviteData.status?"通过":2==this.inviteData.status?"拒绝":"未审核"),m("span.horizontal-spacing"," | "),m("label",n().translator.trans("mattoid-store-invite.lib.item-confirm-time")+": "),m("span",this.inviteData.confirmTime)]),m("div.spacing",[m("label",n().translator.trans("mattoid-store-invite.lib.item-confirm-remark")+": "),m("div",this.inviteData.confirmRemark)])]);return 0==this.inviteData.status&&(i=m("div",[m("div.spacing",[m("textarea.FormControl",{value:this.params.confirmRemark,rows:5,onchange:function(i){t.params.confirmRemark=i.target.value}})]),m("div.center",[m("div.Invite-Button",x().component({type:"submit",className:"Button Button--primary Button--block",loading:this.loading,disabled:this.loading,onclick:function(){t.params.status=1,t.onsubmit()}},n().translator.trans("mattoid-store-invite.forum.confirm-adopt"))),m("div.Invite-Button",x().component({type:"submit",className:"Button Button--primary storeButton--gray",loading:this.loading,disabled:this.loading,onclick:function(){t.params.status=2,t.onsubmit()}},n().translator.trans("mattoid-store-invite.forum.confirm-refuse")))])])),m("div.Invite-Body"+this.class,[m(".Form-group",[m("div",[m("div.rightAligned",x().component({onclick:function(){"expand"==t.buttonName?(t.buttonName="retract",t.class=" .my.extended",0==t.inviteData.status&&(t.class=" .article.extended")):(t.buttonName="expand",t.class="")}},n().translator.trans("mattoid-store-invite.lib.item-button-"+this.buttonName)))]),m("div.spacing",[m("label",n().translator.trans("mattoid-store-invite.lib.item-user")+": "),m("span",D().component({href:"/u/"+this.inviteData.user},m("img",{className:"Invite-Icon",src:this.inviteData.userImg}))),m("span",D().component({href:"/u/"+this.inviteData.user},this.inviteData.user)),m("span.horizontal-spacing"," | "),m("label",n().translator.trans("mattoid-store-invite.lib.item-email")+": "),m("span",this.inviteData.email),m("span.horizontal-spacing"," | "),m("label",n().translator.trans("mattoid-store-invite.lib.item-username")+": "),m("span",this.inviteData.username)]),m("div.spacing",[m("label",n().translator.trans("mattoid-store-invite.lib.item-total-num")+": "),m("span",this.inviteData.totalNum),m("span.horizontal-spacing"," | "),m("label",n().translator.trans("mattoid-store-invite.lib.item-pass-total-num")+": "),m("span",this.inviteData.passTotalNum)]),m("div.spacing",[m("label",n().translator.trans("mattoid-store-invite.lib.item-link")+": "),m("span",D().component({href:this.inviteData.link},this.inviteData.link))]),m("div.spacing",[m("label",n().translator.trans("mattoid-store-invite.lib.item-link-2")+": "),m("span",D().component({href:this.inviteData.link2},this.inviteData.link2))]),m("div.spacing",[m("label",n().translator.trans("mattoid-store-invite.lib.item-apply-rmark")+": "),m("span",this.inviteData.applyRemark)]),i])])},a.onsubmit=function(){var t=this;n().request({method:"PUT",url:n().forum.attribute("apiUrl")+"/store/invite/edit",body:this.params}).then((function(){return location.reload()}),(function(i){t.loading=!1,t.handleErrors(i)}))},i}(g());const N=flarum.core.compat["components/Button"];var R=t.n(N),w=function(t){function i(){for(var i,a=arguments.length,e=new Array(a),n=0;n<a;n++)e[n]=arguments[n];return(i=t.call.apply(t,[this].concat(e))||this).status=p()(),i.query=p()(),i.inviteList=[],i.moreResults=!1,i}r(i,t);var a=i.prototype;return a.oncreate=function(i){t.prototype.oncreate.call(this,i),n().setTitle(n().translator.trans("mattoid-store-invite.forum.invite")),n().setTitleCount(0),this.status=p()("0"),this.query=p()(""),this.loadResults()},a.view=function(){var t=this;return m("div",{className:"IndexPage"},m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"IndexPage-nav sideNav"},m("ul",null,d()(this.sidebarItems().toArray()))),m("div",{className:"StorePage-results sideNavOffset"},m("div",{className:"Post-body"},m("h2",{class:"BadgeOverviewTitle"},n().translator.trans("mattoid-store-invite.forum.invite")),m("div",null,m("div",{className:"Invite-Input"},m(f(),{style:"width: 150px",value:this.status(),disabled:this.loading,options:{"-1":n().translator.trans("mattoid-store-invite.lib.item-status-all"),0:n().translator.trans("mattoid-store-invite.lib.item-status-confirm"),1:n().translator.trans("mattoid-store-invite.lib.item-status-adopt"),2:n().translator.trans("mattoid-store-invite.lib.item-status-refuse")},onchange:function(i){t.status(i),t.inviteList=[],t.loadResults()}})),m("div",{className:"Invite-Input"},m("input",{required:!0,class:"FormControl",style:"width: 200px",type:"text",onblur:function(){t.inviteList=[],t.loadResults()},placeholder:n().translator.trans("mattoid-store-invite.lib.item-query"),bidi:this.query}))),m("div",null,this.inviteList.map((function(t){if(!t.attributes.hide||n().session.user.attribute("can"+t.attributes.code.slice(0,1).toUpperCase()+t.attributes.code.slice(1)+"View"))return m("div",{className:""},I.component({item:t}))}))),!this.loading&&0===this.inviteList.length&&m("div",null,m("div",{style:"font-size:1.4em;color: var(--muted-more-color);text-align: center;line-height: 100px;"},n().translator.trans("mattoid-store.lib.list-empty"))),!this.loading&&this.hasMoreResults()&&m("div",{style:"text-align:center;padding:20px"},m(R(),{className:"Button Button--primary",disabled:this.loading,loading:this.loading,onclick:function(){return t.loadMore()}},n().translator.trans("mattoid-store.lib.list-load-more"))))))))},a.hasMoreResults=function(){return this.moreResults},a.loadMore=function(){this.loading=!0,this.loadResults(this.inviteList.length)},a.parseResults=function(t){return this.moreResults=!!t.payload.links&&!!t.payload.links.next,[].push.apply(this.inviteList,t.payload.data),this.loading=!1,m.redraw(),t},a.loadResults=function(t){void 0===t&&(t=0);var i={query:this.query(),status:this.status()};return n().store.find("/store/invite/list",{filter:i,page:{offset:t}}).catch((function(){})).then(this.parseResults.bind(this))},i}(u());const B=flarum.core.compat["forum/components/UserPage"];var P=t.n(B),q=function(t){function i(){for(var i,a=arguments.length,e=new Array(a),n=0;n<a;n++)e[n]=arguments[n];return(i=t.call.apply(t,[this].concat(e))||this).buttonName="expand",i.class="",i.params={},i.inviteData={},i}r(i,t);var a=i.prototype;return a.oninit=function(i){t.prototype.oninit.call(this,i),this.inviteData=this.attrs.item.attributes},a.view=function(){var t=this,i=m("div",[m("div.spacing",[m("label",n().translator.trans("mattoid-store-invite.lib.item-confirm-user")+": "),m("span",D().component({href:"/u/"+this.inviteData.confirmUser},m("img",{className:"Invite-Icon",src:this.inviteData.confirmUserImg}))),m("span",D().component({href:"/u/"+this.inviteData.confirmUser},this.inviteData.confirmUser)),m("span.horizontal-spacing"," | "),m("label",n().translator.trans("mattoid-store-invite.lib.item-confirm-status")+": "),m("span",1==this.inviteData.status?"通过":2==this.inviteData.status?"拒绝":"未审核"),m("span.horizontal-spacing"," | "),m("label",n().translator.trans("mattoid-store-invite.lib.item-confirm-time")+": "),m("span",this.inviteData.confirmTime)]),m("div.spacing",[m("label",n().translator.trans("mattoid-store-invite.lib.item-confirm-remark")+": "),m("div",this.inviteData.confirmRemark)])]);return 0==this.inviteData.status&&(i=m("div",[m("div.spacing",[m("label",n().translator.trans("mattoid-store-invite.lib.item-confirm-status")+": "),m("span",1==this.inviteData.status?"通过":2==this.inviteData.status?"拒绝":"未审核")])])),m("div.Invite-Body"+this.class,[m(".Form-group",[m("div",[m("div.rightAligned",x().component({onclick:function(){"expand"==t.buttonName?(t.buttonName="retract",t.class=" .my.extended",0==t.inviteData.status&&(t.class=" .my.confirm.extended")):(t.buttonName="expand",t.class="")}},n().translator.trans("mattoid-store-invite.lib.item-button-"+this.buttonName)))]),m("div.spacing",[m("label",n().translator.trans("mattoid-store-invite.lib.item-user")+": "),m("span",D().component({href:"/u/"+this.inviteData.user},m("img",{className:"Invite-Icon",src:this.inviteData.userImg}))),m("span",D().component({href:"/u/"+this.inviteData.user},this.inviteData.user)),m("span.horizontal-spacing"," | "),m("label",n().translator.trans("mattoid-store-invite.lib.item-email")+": "),m("span",this.inviteData.email),m("span.horizontal-spacing"," | "),m("label",n().translator.trans("mattoid-store-invite.lib.item-username")+": "),m("span",this.inviteData.username)]),m("div.spacing",[m("label",n().translator.trans("mattoid-store-invite.lib.item-link")+": "),m("span",D().component({href:this.inviteData.link,target:"_blank"},this.inviteData.link))]),m("div.spacing",[m("label",n().translator.trans("mattoid-store-invite.lib.item-link-2")+": "),m("span",D().component({href:this.inviteData.link2,target:"_blank"},this.inviteData.link2))]),m("div.spacing",[m("label",n().translator.trans("mattoid-store-invite.lib.item-apply-rmark")+": "),m("span",this.inviteData.applyRemark)]),i])])},i}(g()),L=function(t){function i(){for(var i,a=arguments.length,e=new Array(a),n=0;n<a;n++)e[n]=arguments[n];return(i=t.call.apply(t,[this].concat(e))||this).status=p()(),i.query=p()(),i.inviteList=[],i.moreResults=!1,i}r(i,t);var a=i.prototype;return a.oninit=function(i){t.prototype.oninit.call(this,i),this.loadUser(m.route.param("username")),this.status=p()("-1"),this.query=p()(""),this.loadResults()},a.content=function(){var t=this;return m("div",{className:"Post-body"},m("h2",{class:"BadgeOverviewTitle"},n().translator.trans("mattoid-store-invite.forum.my-invite")),m("div",null,m("div",{className:"Invite-Input"},m(f(),{style:"width: 150px",value:this.status(),disabled:this.loading,options:{"-1":n().translator.trans("mattoid-store-invite.lib.item-status-all"),0:n().translator.trans("mattoid-store-invite.lib.item-status-confirm"),1:n().translator.trans("mattoid-store-invite.lib.item-status-adopt"),2:n().translator.trans("mattoid-store-invite.lib.item-status-refuse")},onchange:function(i){t.status(i),t.inviteList=[],t.loadResults()}})),m("div",{className:"Invite-Input"},m("input",{required:!0,class:"FormControl",style:"width: 200px",type:"text",onblur:function(){t.inviteList=[],t.loadResults()},placeholder:n().translator.trans("mattoid-store-invite.lib.item-query"),bidi:this.query}))),m("div",null,this.inviteList.map((function(t){if(!t.attributes.hide||n().session.user.attribute("can"+t.attributes.code.slice(0,1).toUpperCase()+t.attributes.code.slice(1)+"View"))return m("div",{className:""},q.component({item:t}))})),!this.loading&&0===this.inviteList.length&&m("div",null,m("div",{style:"font-size:1.4em;color: var(--muted-more-color);text-align: center;line-height: 100px;"},n().translator.trans("mattoid-store.lib.list-empty"))),!this.loading&&this.hasMoreResults()&&m("div",{style:"text-align:center;padding:20px"},m(R(),{className:"Button Button--primary",disabled:this.loading,loading:this.loading,onclick:function(){return t.loadMore()}},n().translator.trans("mattoid-store.lib.list-load-more")))))},a.hasMoreResults=function(){return this.moreResults},a.loadMore=function(){this.loading=!0,this.loadResults(this.inviteList.length)},a.parseResults=function(t){return this.moreResults=!!t.payload.links&&!!t.payload.links.next,[].push.apply(this.inviteList,t.payload.data),this.loading=!1,m.redraw(),t},a.loadResults=function(t){void 0===t&&(t=0);var i={query:this.query(),status:this.status(),username:this.user.slug()};return n().store.find("/store/invite/list",{filter:i,page:{offset:t}}).catch((function(){})).then(this.parseResults.bind(this))},i}(P());n().initializers.add("mattoid/flarum-ext-store-invite",(function(){n().routes.invite={path:"/invite",component:w},n().routes.myInvitePage={path:"/u/:username/invite",component:L},(0,s.extend)(P().prototype,"navItems",(function(t){t.add("myInvitePage",D().component({href:n().route("myInvitePage",{username:this.user.slug()}),icon:"fas fa-check-square"},n().translator.trans("mattoid-store-invite.forum.my-invite")))})),(0,s.extend)(u().prototype,"navItems",(function(t){if(!n().session.user.attribute("canInviteAdminView")||0==n().forum.attribute("inviteShowIndex"))return!1;t.add("invite",D().component({href:n().route("invite"),icon:"fas fa-calendar-check"},n().translator.trans("mattoid-store-invite.forum.invite")))}))}))})(),module.exports=i})();
//# sourceMappingURL=forum.js.map